---
export const prerender = false
// import "@/style/app.css"
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
>
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body class="flex bg-gray-100 items-center justify-center h-[100svh] w-full">

 <main class="container">
   <div id="message-container" class="response" aria-live="polite" hidden></div>
   <form class="flex flex-col" method="POST" action="/api/contact" enctype="multipart/form-data">
    <label>First Name
    <input type="text" name="first_name" required />
    </label>
    <label>Last Name
    <input type="text" name="last_name" required />
    </label>
    <label>Email
      <input type="email" name="email" required />
    </label>
    <label>message
      <textarea name="message" required></textarea>
    </label>
    <input
      type="file"
      name="attachment"
      accept=".pdf,.doc,.docx"
      required
    />
    <button type="submit">Send</button>
   </form>
 </main>

	</body>
</html>

<script is:inline>
  const form = document.querySelector('form');
  const messageContainer = document.getElementById('message-container');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    // Reset message container
    messageContainer.textContent = '';
    messageContainer.classList.remove('success', 'error');
    messageContainer.hidden = true;

    // Client-side validation
    const file = formData.get('attachment');
    const maxSize = 1 * 1024 * 1024; // 1MB

    if (!formData.get('first_name') || !formData.get('last_name') || !formData.get('email') || !formData.get('message')) {
      messageContainer.textContent = 'All fields are required.';
      messageContainer.classList.add('error');
      messageContainer.hidden = false;
      console.log('All fields are required.');
      return;
    }

    if (file instanceof File) {
      const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];

      if (!validTypes.includes(file.type)) {
        messageContainer.textContent = 'Only PDF or DOC/DOCX files are allowed.';
        messageContainer.classList.add('error');
        messageContainer.hidden = false;
        console.log('Only PDF or DOC/DOCX files are allowed.');
        return;
      }

      if (file.size > maxSize) {
        messageContainer.textContent = 'File must be under 1MB.';
        messageContainer.classList.add('error');
        messageContainer.hidden = false;
        console.log('File must be under 1MB.');
        return;
      }
    }

    

    const response = await fetch('/api/contact', {
      method: 'POST',
      body: formData, // Don't set Content-Type manually
    });

    if (response.ok) {
      messageContainer.textContent = 'Email sent!';
      messageContainer.classList.add('success');
      messageContainer.hidden = false;
      console.log('Email sent!');
      form.reset();
    } else {
      const error = await response.text();
      messageContainer.textContent = `Something went wrong: ${error}`;
      messageContainer.classList.add('error');
      messageContainer.hidden = false;
      console.log(`Something went wrong: ${error}`);
    }
  });
</script>

<style>
  .response {
    --_text: black;
    --_background: #eee;
    --_border: #ccc;
    color: var(--_text);
    background-color: var(--_background);
  }

  .response:not([hidden]) {
    padding: 1rlh;
    border: 2px solid var(--_border);
  }

  .response.success {
    --_text: #0c4322;
    --_background: #b5ebcb;
    --_border: #529d70;
  }

  .response.error {
    --_text: #721c24;
    --_background: #f8d7da;
    --_border: #f5c6cb;
  }
</style>
